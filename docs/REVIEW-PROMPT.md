# Ivan's Workflow — Completeness Review Prompt

**Give this prompt to Claude in a fresh conversation with access to Desktop Commander (or Claude Code with filesystem access).**

---

## PROMPT BEGINS

You are reviewing the **Ivan's Workflow** framework at `~/projects/ivans-workflow` for completeness against its implementation specification. The spec is at `/home/vanya/Nextcloud/PROJECTS/ebatt-ai-implementation/docs/plans/IVANS-WORKFLOW-SETUP-PROMPT-v1.md` and the credential manager redesign spec is at `/home/vanya/Nextcloud/PROJECTS/ebatt-ai-implementation/docs/plans/CREDENTIAL-MANAGER-REDESIGN-v1.md`.

Your job is to audit every file for existence, correct content structure, and adherence to the spec's requirements. Work through the checklist below systematically. For each item, read the actual file and compare against the spec's requirements. Report PASS, FAIL, or PARTIAL with a brief explanation.

**Do not fix anything. Only audit and report.**

---

## CHECKLIST

### STEP 1: Repository Structure

- [ ] `~/projects/ivans-workflow/` exists as a git repo with at least one commit
- [ ] `.gitignore` exists and blocks: `*.env`, `*.local.json`, `credentials.env`, `.dev.vars`, `*.secret`, `*.key`, `.claude/settings.local.json`, `.DS_Store`, `Thumbs.db`, `.vscode/`, `.idea/`, `*.swp`, `*~`
- [ ] `LICENSE` exists and is MIT
- [ ] `README.md` exists at root
- [ ] `install.sh` exists and is executable (`-x` permission)
- [ ] `update.sh` exists and is executable
- [ ] `uninstall.sh` exists and is executable

**Directory structure — verify all directories exist:**
- [ ] `core/agents/` with 8 files
- [ ] `core/commands/` with 9 files
- [ ] `core/hooks/` with 6 files
- [ ] `core/skills/` with 8 subdirectories, each containing SKILL.md
- [ ] `core/scripts/` with 2 files
- [ ] `core/rules/` with 2 files
- [ ] `scripts/` with 3 files
- [ ] `templates/` with 4 files + `rules/` subdir with 2 files
- [ ] `docs/` with 4 files

### STEP 2: Project Configuration Template

- [ ] `templates/project-config.yaml.tmpl` exists
- [ ] Contains all sections: `project`, `stack`, `schema`, `specs`, `paths`, `agents`, `quality`, `credentials`
- [ ] `stack` section includes: runtime, framework, language, test_runner, linter, formatter, deploy_command, dev_command
- [ ] `schema` section includes: enabled, definitions, generated_types, generate_command, config_file
- [ ] `specs` section includes: enabled, directories, id_prefix
- [ ] `paths` section includes: source, tests, handoffs
- [ ] `agents` section includes: count, builder_mode, planner_mode
- [ ] `quality` section includes: typecheck_command, test_command, lint_command, coverage_threshold
- [ ] `credentials` section exists with example structure (alias, bitwarden_entry, env_vars with name+field)
- [ ] Uses `${VARIABLE}` placeholders for installer substitution

### STEP 3: Installer

- [ ] `install.sh` is executable
- [ ] Has `# Generated by Ivan's Workflow` header comment (or similar branding)
- [ ] Prompts for project directory (default: current)
- [ ] Prompts for project name and description
- [ ] Prompts for runtime via menu (cloudflare-workers / node / deno / python)
- [ ] Prompts for framework via menu (hono / express / nextjs / fastapi / none)
- [ ] Prompts for language via menu (typescript / javascript / python)
- [ ] Prompts for schema-first (yes/no) — conditional path prompts
- [ ] Prompts for spec-driven development (yes/no) — conditional prefix/dir prompts
- [ ] Prompts for agent count (4/5/6, default 4)
- [ ] Prompts for link mode (symlink/copy, default symlink)
- [ ] Creates `.claude/` directory structure in target project
- [ ] Symlinks or copies core files (agents, commands, hooks, skills, scripts, rules)
- [ ] Generates `project-config.yaml` from template with answers substituted
- [ ] Generates `hooks.json` from template
- [ ] Generates `settings.json` from template
- [ ] Generates `CLAUDE.md` from template (skip if exists and not a symlink)
- [ ] Generates `rules/project-stack.md` from template based on stack
- [ ] Creates placeholder `rules/project-domain.md`
- [ ] Symlinks launch script to `scripts/ivans-workflow/launch.sh`
- [ ] Creates `docs/agent-comms/` directory
- [ ] Adds machine-specific entries to project `.gitignore`
- [ ] Prints colored summary with next steps
- [ ] Is idempotent (safe to re-run — doesn't overwrite customized non-symlink files)
- [ ] Uses `set -euo pipefail` or equivalent error handling
- [ ] Uses colored terminal output

### STEP 4: Core Agent Definitions

**For EACH of these 8 files, verify it exists AND contains all required sections:**

Files: `core/agents/code-simplifier.md`, `verify-app.md`, `ux-reviewer.md`, `schema-guardian.md`, `integration-tester.md`, `pr-architect.md`, `perf-monitor.md`, `docs-agent.md`

Per-file checklist:
- [ ] Has YAML frontmatter with: name, description, model, allowed-tools, denied-tools
- [ ] Has ## Purpose section
- [ ] Has ## When to Use section
- [ ] Has ## What It Does section (numbered steps)
- [ ] Has ## Hard Boundaries (DO NOT) section
- [ ] Has ## Safety Limits section (max files, iterations, timeout)
- [ ] Has ## Escalation Criteria section
- [ ] Has ## Definition of Done section
- [ ] Has ## Output Format section
- [ ] References `project-config.yaml` for paths/commands (not hardcoded)

**Per-agent specifics:**
- [ ] `code-simplifier.md`: model=inherit, max 15 files, 10 passes, 500-line diff, 5-min timeout
- [ ] `verify-app.md`: model=haiku, denied Write/Edit/git, reads dev_command from config
- [ ] `ux-reviewer.md`: model=inherit, denied Write/Edit/Bash/git, UI-only trigger
- [ ] `schema-guardian.md`: model=sonnet, write restricted to schema/+generated/, has "not enabled" fallback
- [ ] `integration-tester.md`: model=sonnet, denied Write/Edit/deploy/git push
- [ ] `pr-architect.md`: model=haiku, denied Write/Edit, has risk classification criteria
- [ ] `perf-monitor.md`: model=haiku, denied Write/Edit/deploy/git, configurable thresholds
- [ ] `docs-agent.md`: model=sonnet, write restricted to docs/+CLAUDE.md+CHANGELOG.md

### STEP 5: Core Skills

**For EACH of these 8 SKILL.md files, verify existence AND required sections:**

Files: `core/skills/planner-agent/SKILL.md`, `builder-agent/SKILL.md`, `reviewer-agent/SKILL.md`, `tester-agent/SKILL.md`, `deployer-agent/SKILL.md`, `docs-agent/SKILL.md`, `workflow-handoff/SKILL.md`, `spec-checklist/SKILL.md`

Per-skill checklist:
- [ ] Has YAML frontmatter with name and description
- [ ] Has Honesty Protocol section (bans inflated language, requires evidence)
- [ ] Has Handoff Protocol section (JSON schema or 5-line quick format)
- [ ] Has explicit "What You DO" / "What You DON'T DO" boundaries
- [ ] Has Definition of Done checklist
- [ ] Has Definition of Failure section (when/how to report failure)
- [ ] References project-config.yaml (not hardcoded paths/commands)

**Per-skill specifics:**
- [ ] `planner-agent`: plan mode activation, outputs implementation plan + handoff to Builder
- [ ] `builder-agent`: auto-accept mode, implements phase by phase, runs tests after each, uses /test-and-commit, defers schema to @schema-guardian
- [ ] `reviewer-agent`: two-pass protocol (automated → manual), reads git diff + Builder handoff
- [ ] `tester-agent`: invokes @integration-tester, @perf-monitor, @docs-agent, @pr-architect subagents
- [ ] `deployer-agent`: runs deploy command from config, creates PR via @pr-architect
- [ ] `docs-agent` (skill): formatted as skill with first-response template
- [ ] `workflow-handoff`: defines JSON handoff schema AND 5-line quick handoff format
- [ ] `spec-checklist`: reads spec file, extracts acceptance criteria, generates verification checklist

### STEP 6: Core Commands

**For EACH of these 9 command files, verify existence and correct behavior description:**

Files: `core/commands/test-and-commit.md`, `commit-push-pr.md`, `ralph-loop.md`, `agent-handoff.md`, `workflow-start.md`, `workflow-next.md`, `workflow-status.md`, `compact-and-continue.md`, `chat-completion.md`

- [ ] `test-and-commit.md`: reads commands from config, runs typecheck→lint→test, commits only if ALL pass, conventional commit format
- [ ] `commit-push-pr.md`: commit, push to feature branch, create PR via @pr-architect, includes pre-push verification
- [ ] `ralph-loop.md`: max 50 iterations, stops if same error 10x, outputs iteration progress
- [ ] `agent-handoff.md`: writes to `{config:paths.handoffs}/{TASK-ID}/`, includes JSON + 5-line format
- [ ] `workflow-start.md`: creates handoff folder, validates spec prefix from `{config:specs.id_prefix}`
- [ ] `workflow-next.md`: reads current handoff, identifies next agent, outputs tmux switch instructions
- [ ] `workflow-status.md`: shows all active tasks, current agent stage, blockers
- [ ] `compact-and-continue.md`: saves state → /compact → reads state back → continues
- [ ] `chat-completion.md`: end-of-session wrap-up, handoff summary, token usage, next actions

### STEP 7: Core Hooks

**For EACH hook, verify existence, executable permission, and correct behavior:**

- [ ] `core/hooks/builder-guard.sh` — executable, PreToolUse, reads JSON stdin, blocks writes to generated/ and schema (when enabled), blocks Node builtins in Workers runtime, blocks process.env in Workers, blocks inline types when schema enabled, returns exit 2 with deny JSON, reads project-config.yaml
- [ ] `core/hooks/verify-work.sh` — executable, Stop hook (blocking), runs typecheck+lint+test from config, reports pass/fail with color
- [ ] `core/hooks/pre-review-checks.sh` — executable, NOT a hook (invoked by Reviewer), runs 6 checks: typecheck+lint, import audit, hardcoded values, error handling, runtime compat, schema regen check
- [ ] `core/hooks/classify-risk.sh` — executable, reads git diff, outputs RISK_LEVEL (CRITICAL/HIGH/MEDIUM/LOW) with correct criteria per level
- [ ] `core/hooks/metrics-logger.mjs` — executable, PostToolUse, logs to `.claude/metrics/session-{date}.jsonl`, lightweight/non-blocking
- [ ] `core/hooks/prompt-handoff.sh` — executable, Stop hook (non-blocking), injects handoff reminder when task in progress

### STEP 8: Templates

- [ ] `templates/hooks.json.tmpl` — valid JSON structure with PreToolUse (builder-guard), PostToolUse (metrics-logger), Stop (verify-work blocking + prompt-handoff non-blocking)
- [ ] `templates/settings.json.tmpl` — safe permissions: allows Read/Edit/Write/common Bash, denies `rm -rf /`, `sudo`, `chmod 777`
- [ ] `templates/CLAUDE.md.tmpl` — ~100 lines, sections for: project identity, golden rules (5), file structure, stack, commands, current state placeholder. Uses config placeholders.
- [ ] `templates/project-config.yaml.tmpl` — (already checked in Step 2)
- [ ] `templates/rules/project-stack.md.tmpl` — contains conditional content for different runtimes (cloudflare-workers constraints, node patterns, etc.), includes glob patterns in frontmatter
- [ ] `templates/rules/project-domain.md.tmpl` — placeholder with instructions for user to fill in

### STEP 9: Launch Script

- [ ] `scripts/launch-tmux-agents.sh` exists and is executable
- [ ] Reads `project-config.yaml` for agent count, builder mode, project name
- [ ] Creates tmux session with project-specific name (e.g., `ivan-{project}`)
- [ ] Launches configured number of agents (4, 5, or 6)
- [ ] Each window: cd to project, launch claude CLI, set IVAN_AGENT_ROLE env var
- [ ] Sends initialization message activating appropriate skill
- [ ] Builder gets auto-accept mode flag (`--dangerously-skip-permissions` or equivalent)
- [ ] Staggered startup (waits between agent launches)
- [ ] Prints completion summary with window assignments and tmux commands
- [ ] Auto-attaches to tmux session
- [ ] Has `--kill` flag to terminate session
- [ ] Calls `load-project-credentials.sh` before launching agents
- [ ] Handles credential loading failure (asks to continue without)

- [ ] `scripts/monitor-agents.sh` exists and is executable — shows per-window health
- [ ] `scripts/setup-credentials.sh` exists and is executable — Bitwarden setup

### STEP 10: Documentation

- [ ] `docs/GETTING-STARTED.md` exists — covers prerequisites, install, first setup, launching, workflow walkthrough, useful commands
- [ ] `docs/CUSTOMIZATION.md` exists — covers custom agents, rules, hooks, credentials, MCP servers, skills, updating, multi-project
- [ ] `docs/AGENT-REFERENCE.md` exists — reference for all main agents + all subagents with purpose/model/does/doesn't
- [ ] `docs/TROUBLESHOOTING.md` exists — covers agent startup, hook failures, credential errors, tmux management, context rot, handoff issues

### STEP 11: README.md

- [ ] Professional quality suitable for public GitHub
- [ ] One-line project description
- [ ] Quick install section (3 commands or fewer)
- [ ] "What it does" explanation
- [ ] Architecture diagram (ASCII)
- [ ] Main agent overview table (6 agents with window/mode/purpose)
- [ ] Subagent overview table (8 subagents with model/purpose)
- [ ] Hook overview table
- [ ] Slash command reference
- [ ] Configuration reference (project-config.yaml fields or link)
- [ ] Comparison table: Ivan's Workflow vs vanilla Claude Code
- [ ] Contributing section
- [ ] License (MIT)

### STEP 12: Git & Testing

- [ ] Git repo has at least one commit
- [ ] All files are committed (no uncommitted changes)
- [ ] Commit message follows conventional format

**Local installation test (run this):**
```bash
mkdir -p /tmp/ivan-test && cd /tmp/ivan-test && git init && npm init -y
# Run installer non-interactively or interactively
~/projects/ivans-workflow/install.sh
# Verify:
ls -la .claude/agents/         # Symlinks or copies exist?
ls -la .claude/commands/        # Symlinks or copies exist?
ls -la .claude/hooks/           # Symlinks or copies exist?
ls -la .claude/skills/          # Skill directories exist?
ls -la .claude/scripts/         # credential-helper.sh + load-project-credentials.sh?
cat .claude/project-config.yaml # Generated with substituted values?
cat .claude/hooks.json          # Valid JSON?
python3 -m json.tool .claude/hooks.json  # Validates JSON
cat CLAUDE.md                   # Generated?
rm -rf /tmp/ivan-test
```

### STEP 13: Credential Manager

- [ ] `core/scripts/credential-helper.sh` exists and is executable
- [ ] Supports commands: `get <alias> [field]`, `load`, `list`, `status`
- [ ] Three-strategy fallback: BW_SESSION → GNOME Keyring → interactive prompt
- [ ] Strategy 2: pipes master password via stdin (NOT as CLI argument)
- [ ] Strategy 2: handles DBUS_SESSION_BUS_ADDRESS for non-desktop shells
- [ ] Strategy 3: if stdin is terminal, prompts directly; otherwise prints instructions
- [ ] `get` command: reads alias → bitwarden_entry mapping from project-config.yaml
- [ ] `get` command: supports fields: password, username, url, notes
- [ ] `load` command: iterates all credentials in config, exports each env_var
- [ ] `list` command: shows configured aliases with Bitwarden entry names
- [ ] `status` command: shows BW CLI status, BW_SESSION presence, keyring status, configured credentials
- [ ] Config parsing uses awk (no yq dependency)
- [ ] Uses `set -euo pipefail`
- [ ] Has colored output

- [ ] `core/scripts/load-project-credentials.sh` exists and is executable
- [ ] Is a thin wrapper that calls `credential-helper.sh load`

- [ ] `core/skills/credential-manager/SKILL.md` exists
- [ ] Documents three-strategy fallback
- [ ] Has usage examples for get, load, list, status
- [ ] Explains project-config.yaml credential structure
- [ ] Has troubleshooting section for auto-unlock failures
- [ ] Has security notes (stdin not CLI args, entry names not secrets)
- [ ] Notes that launch script calls load-project-credentials.sh automatically

**Launch script integration:**
- [ ] `scripts/launch-tmux-agents.sh` sources credential loader before agent launch
- [ ] Handles credential failure with user prompt to continue or abort

**Installer integration:**
- [ ] `install.sh` asks about Bitwarden usage
- [ ] If yes: prompts for credential entries and writes to config
- [ ] If no: writes `credentials: []`
- [ ] Symlinks/copies credential-helper.sh and load-project-credentials.sh

### STEP 14: GitHub

- [ ] Repo exists at https://github.com/No-Smoke/ivans-workflow
- [ ] Repo is public
- [ ] All files are pushed (remote matches local)
- [ ] Repo description is set

### CROSS-CUTTING CONSTRAINTS

- [ ] All bash scripts use `set -euo pipefail` (except launch script which uses `set -uo pipefail`)
- [ ] All hook scripts are executable
- [ ] All generated files have `# Generated by Ivan's Workflow` header (check a sample of 5+)
- [ ] No hardcoded project paths in any agent/skill/command (search for `src/`, `generated/types.ts`, `npm test` etc. — should use config references)
- [ ] Symlinks in installed projects use absolute paths (not relative)

---

## OUTPUT FORMAT

Produce a structured report with:

1. **Summary**: X/Y items passed, Z failed, W partial
2. **Failures**: List each failed item with file path, what was expected, what was found
3. **Partials**: List each partial item with what's present and what's missing
4. **Notable observations**: Anything that technically passes but could be improved
5. **Recommendation**: READY TO USE / NEEDS FIXES (with priority list)

---

## PROMPT ENDS
