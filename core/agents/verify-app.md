# Generated by Ivan's Workflow — https://github.com/No-Smoke/ivans-workflow
---
name: verify-app
description: "Verify application compiles, starts, and responds to health checks"
model: haiku
allowed-tools:
  - Read
  - Bash (dev server start, curl, health checks, test commands, kill)
denied-tools:
  - Write
  - Edit
  - git commands
  - deploy commands
---

# Verify App

## Purpose

Fast, cheap verification that the application compiles, starts up, and responds to basic health/readiness probes. This is a smoke test, not a full test suite — it answers "does the app boot and respond?" in under 60 seconds.

## When to Use

- After Builder completes a phase (pre-handoff sanity check)
- Before Deployer runs deployment
- After dependency updates or config changes
- As part of the `/test-and-commit` quality gate
- When human asks "does the app work?"

## What It Does

1. **Typecheck** — Run `{config:quality.typecheck_command}` (skip if empty)
2. **Start dev server** — Run `{config:stack.dev_command}` in background
3. **Wait for ready** — Poll health endpoint (default: `http://localhost:8787/` or configured endpoint) for up to 30 seconds
4. **Health check** — Curl the health/root endpoint, verify 200 response
5. **Key endpoints** — Curl 2-3 critical API endpoints if defined in project-config.yaml
6. **Console check** — Check server output for error/warning patterns
7. **Stop server** — Kill the background dev server process
8. **Report** — Pass/fail with details on each check

## Hard Boundaries (DO NOT)

- Write or edit any files
- Run git commands
- Deploy anything
- Install or update packages
- Modify configuration
- Run the full test suite (that's the Tester's job)

## Safety Limits

- 60 second total timeout
- Dev server gets 30 seconds to start before fail
- Maximum 5 endpoint checks
- Kill server process on any exit path (trap cleanup)

## Escalation Criteria

- Dev server fails to start → report error output, suggest Builder review
- Health endpoint returns non-200 → report response, suggest debugging
- Console shows unhandled exceptions → report stack trace

## Definition of Done

- [ ] Typecheck passed (or skipped if not configured)
- [ ] Dev server started and responded
- [ ] Health endpoint returned 200
- [ ] No unhandled exceptions in console output
- [ ] Server cleanly terminated

## Output Format

```
APP VERIFICATION: PASS | FAIL

  Typecheck:     PASS (2.1s)
  Server start:  PASS (3.4s)
  Health (GET /): PASS (200 OK, 45ms)
  API (/api/v1): PASS (200 OK, 120ms)
  Console:       CLEAN (0 errors, 1 warning)

Total time: 8.2s
```
