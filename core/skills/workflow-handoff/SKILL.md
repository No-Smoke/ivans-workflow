# Generated by Ivan's Workflow — https://github.com/No-Smoke/ivans-workflow
---
name: workflow-handoff
description: "Standard handoff protocol shared across all agents. Defines JSON handoff schema and quick handoff format for structured inter-agent communication."
---

# Workflow Handoff Protocol

## Purpose

This skill defines the standard protocol for passing work between agents in Ivan's Workflow. Every agent uses this protocol when completing a phase and handing work to the next agent in the pipeline.

## Handoff Directory

All handoffs are stored in the project's configured handoff directory:
- Read `paths.handoffs` from `.claude/project-config.yaml`
- Default: `docs/agent-comms/`
- Structure: `{handoffs_dir}/{TASK-ID}/`

## JSON Handoff Schema

Every handoff file follows this schema:

```json
{
  "handoff": {
    "id": "TASK-ID-AGENT-TIMESTAMP",
    "task_id": "TASK-001",
    "from_agent": "builder",
    "to_agent": "reviewer",
    "timestamp": "2026-02-11T14:30:00Z",
    "status": "complete|partial|blocked",
    "confidence": "high|medium|low"
  },
  "summary": {
    "what_was_done": "One paragraph describing completed work",
    "key_decisions": ["Decision 1 with rationale", "Decision 2"],
    "files_changed": ["src/path/file.ts", "tests/path/file.test.ts"],
    "files_created": ["src/new/file.ts"],
    "tests_status": {
      "passed": 12,
      "failed": 0,
      "skipped": 1,
      "output": "First 20 lines of test output"
    }
  },
  "context": {
    "spec_id": "SPEC-001 or null",
    "acceptance_criteria_met": ["AC-1", "AC-2"],
    "acceptance_criteria_remaining": ["AC-3"],
    "blockers": [],
    "risks": ["Risk description if any"],
    "assumptions": ["Assumption made during implementation"]
  },
  "for_next_agent": {
    "focus_areas": ["What the next agent should look at first"],
    "known_issues": ["Known issue that needs attention"],
    "skip_areas": ["Areas already verified, no need to re-check"],
    "suggested_approach": "Brief guidance for next agent"
  }
}
```

## Quick Handoff Format (5-Line)

For lightweight handoffs in chat or when full JSON is overkill:

```
HANDOFF: {from_agent} → {to_agent} | {task_id}
STATUS: {complete|partial|blocked} | Confidence: {high|medium|low}
DONE: {one-line summary of what was completed}
FILES: {comma-separated list of key files changed}
NEXT: {one-line instruction for the next agent}
```

## Handoff File Naming Convention

```
{handoffs_dir}/{TASK-ID}/{sequence}-{from_agent}-to-{to_agent}.json
```

Examples:
- `docs/agent-comms/TASK-001/01-planner-to-builder.json`
- `docs/agent-comms/TASK-001/02-builder-to-reviewer.json`
- `docs/agent-comms/TASK-001/03-reviewer-to-builder.json` (revision request)
- `docs/agent-comms/TASK-001/04-builder-to-reviewer.json` (revision complete)
- `docs/agent-comms/TASK-001/05-reviewer-to-tester.json`

## Agent Pipeline Order

The standard agent pipeline is:
1. **Planner** → designs the approach
2. **Builder** → implements the design
3. **Reviewer** → reviews the implementation
4. **Tester** → runs tests and verification
5. **Deployer** (optional) → deploys to production
6. **Docs** (optional) → updates documentation

Agents may loop back:
- Reviewer → Builder (revision requested)
- Tester → Builder (test failures found)
- Deployer → Builder (deployment issue)

## Reading a Handoff

When starting work, the agent should:
1. Check the handoff directory for the current task
2. Read the most recent handoff file addressed to this agent
3. Verify the `to_agent` field matches the current agent role
4. Use `for_next_agent` to prioritize work
5. Reference `context` for spec compliance checking

## Writing a Handoff

When completing work, the agent should:
1. Gather all deliverables (files changed, test results, decisions)
2. Write the full JSON handoff to the handoff directory
3. Print the 5-line quick handoff to the terminal for human visibility
4. If the task is blocked, clearly state what's needed to unblock

## Honesty Protocol

- Report actual test results, not expected results
- If tests were not run, say so explicitly
- If confidence is low, say so — don't inflate status
- If work is partial, list exactly what's done and what remains
- Never claim "all acceptance criteria met" without checking each one

## Definition of Done (for Handoff)

- [ ] Handoff JSON written to correct directory path
- [ ] All `files_changed` and `files_created` are accurate
- [ ] Test status reflects actual test run output
- [ ] `for_next_agent` contains actionable guidance
- [ ] Quick handoff printed to terminal
