# Generated by Ivan's Workflow — https://github.com/No-Smoke/ivans-workflow
# Stack-specific rules for: ${RUNTIME} / ${FRAMEWORK}
---
globs:
  - "${SOURCE_DIR}/**/*.${LANG_EXT}"
---

# Stack Rules: ${RUNTIME} + ${FRAMEWORK}

## Runtime: ${RUNTIME}

### cloudflare-workers
_These rules apply only when runtime is cloudflare-workers:_
- Do NOT use Node.js builtins (fs, path, os, child_process)
- Do NOT use `process.env` — use Hono `c.env.VAR` or Workers env bindings
- Do NOT use `node:` protocol imports
- Database: Use D1 (SQLite), KV, R2, Durable Objects — not external databases
- Crypto: Use `crypto.subtle` (Web Crypto API), not `crypto` module
- Keep Worker bundle <1MB compressed
- Target <100ms cold start, <50ms warm response

### node
_These rules apply only when runtime is node:_
- Use `import` syntax (ESM), not `require` (CJS) unless legacy compatibility needed
- Handle process signals (SIGTERM, SIGINT) for graceful shutdown
- Use connection pooling for database connections
- Set appropriate timeouts for all external requests

### deno
_These rules apply only when runtime is deno:_
- Use URL imports or import maps
- Use Deno.* APIs where appropriate
- Permissions are explicit — document required permissions

### python
_These rules apply only when runtime is python:_
- Use type hints on all function signatures
- Use virtual environments (venv/poetry)
- Follow PEP 8 formatting (enforced by configured formatter)

## Framework: ${FRAMEWORK}

### hono
- Use `Hono` app factory pattern
- Middleware via `app.use()`
- Route handlers return `c.json()`, `c.text()`, or `c.html()`
- Error handling via `app.onError()`

### express
- Use router factory pattern
- Middleware order matters — error handler last
- Use `express.json()` for body parsing
- Async errors need `next(err)` or express-async-errors

### nextjs
- App Router preferred over Pages Router
- Server Components by default, `'use client'` only when needed
- API routes in `app/api/`
- Use Next.js Image, Link, and Font components

### fastapi
- Use Pydantic models for request/response validation
- Dependency injection via `Depends()`
- Async endpoints by default
- Use `HTTPException` for error responses

### none
- No framework-specific rules apply
